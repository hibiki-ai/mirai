<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Daemons (Configure Persistent Processes) — daemons • mirai</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Daemons (Configure Persistent Processes) — daemons"><meta property="og:description" content="Set 'daemons' or persistent background processes receiving mirai
    requests. These are by default created on the local machine.
    Alternatively, for distributing tasks across the network, a host URL
    may be specified to receive connections from remote daemons started with
    daemon. Daemons may use either the dispatcher, which
    ensures tasks are assigned to daemons efficiently on a FIFO basis, or
    else the low-level approach of distributing tasks to daemons equally."><meta property="og:image" content="https://shikokuchuo.net/mirai/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mirai</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.1.9025</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/shikokuchuo/mirai/" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://shikokuchuo.net/" class="external-link">
    <span class="fa fa-cube"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Daemons (Configure Persistent Processes)</h1>
    <small class="dont-index">Source: <a href="https://github.com/shikokuchuo/mirai/blob/HEAD/R/mirai.R" class="external-link"><code>R/mirai.R</code></a></small>
    <div class="hidden name"><code>daemons.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Set 'daemons' or persistent background processes receiving <code><a href="mirai.html">mirai</a></code>
    requests. These are by default created on the local machine.
    Alternatively, for distributing tasks across the network, a host URL
    may be specified to receive connections from remote daemons started with
    <code><a href="daemon.html">daemon</a></code>. Daemons may use either the dispatcher, which
    ensures tasks are assigned to daemons efficiently on a FIFO basis, or
    else the low-level approach of distributing tasks to daemons equally.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">daemons</span><span class="op">(</span></span>
<span>  <span class="va">n</span>,</span>
<span>  url <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dispatcher <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tls <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .compute <span class="op">=</span> <span class="st">"default"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>n</dt>
<dd><p>integer number of daemons to set.</p></dd>


<dt>url</dt>
<dd><p>[default NULL] if specified, the character URL or vector of URLs
on the host for remote daemons to dial into, including a port accepting
incoming connections (and optionally for websockets, a path), e.g.
'tcp://192.168.0.2:5555' or 'ws://192.168.0.2:5555/path'. Specify
'tls+tcp://' or 'wss://' to use secure TLS connections.</p></dd>


<dt>dispatcher</dt>
<dd><p>[default TRUE] logical value whether to use dispatcher.
Dispatcher is a local background process that connects to daemons on
behalf of the host and ensures FIFO scheduling, queueing tasks if
necessary (see Dispatcher section below).</p></dd>


<dt>seed</dt>
<dd><p>[default NULL] (optional) supply a random seed (single value,
interpreted as an integer). This is used to inititalise the L'Ecuyer-CMRG
RNG streams sent to each daemon. Note that reproducible results can be
expected only for 'dispatcher = FALSE', as the unpredictable timing of
task completions would otherwise influence the tasks sent to each daemon.
Even for 'dispatcher = FALSE', reproducibility is not guaranteed if the
order in which tasks are sent is not deterministic.</p></dd>


<dt>tls</dt>
<dd><p>[default NULL] (optional for secure TLS connections) if not
supplied, zero-configuration single-use keys and certificates are
automatically generated. If supplied, <strong>either</strong> the character path
to a file containing the PEM encoded certificate and associated private
key (may contain additional certificates leading to a validation chain,
with the leaf certificate first, although the self-signed root is not
required as the daemon should already have this), <strong>or</strong> a length 2
character vector comprising [i] the certificate (optionally certificate
chain) and [ii] the associated private key.</p></dd>


<dt>...</dt>
<dd><p>additional arguments passed through to <code><a href="dispatcher.html">dispatcher</a></code> if
using dispatcher and/or <code><a href="daemon.html">daemon</a></code> if launching local daemons.</p></dd>


<dt>.compute</dt>
<dd><p>[default 'default'] character compute profile to use for
creating the daemons (each compute profile has its own set of daemons for
connecting to different resources).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Depending on the arguments supplied:</p>
<p></p>
<ul><li><p>using dispatcher: integer number of daemons set.</p></li>
<li><p>or else launching local daemons: integer number of daemons launched.</p></li>
<li><p>otherwise: the character host URL.</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>Use <code>daemons(0)</code> to reset daemon connections:</p><ul><li><p>A reset is required before revising settings for the same compute
    profile, otherwise changes are not registered.</p></li>
<li><p>All connected daemons and/or dispatchers exit automatically.</p></li>
<li><p><span class="pkg">mirai</span> reverts to the default behaviour of creating a new
    background process for each request.</p></li>
<li><p>Any unresolved 'mirai' will return an 'errorValue' 7 (Object
    closed) after a reset.</p></li>
</ul><p>If the host session ends, for whatever reason, all connected dispatcher
    and daemon processes automatically exit as soon as their connections are
    dropped. If a daemon is processing a task, it will exit as soon as the
    task is complete.</p>
<p>For historical reasons, <code>daemons()</code> with no arguments returns the
    value of <code><a href="status.html">status</a></code>.</p>
    </div>
    <div id="dispatcher">
    <h2>Dispatcher</h2>
    


<p>By default <code>dispatcher = TRUE</code>. This launches a background process
    running <code><a href="dispatcher.html">dispatcher</a></code>. Dispatcher connects to daemons on
    behalf of the host and queues tasks until a daemon is able to begin
    immediate execution of that task, ensuring FIFO scheduling. Dispatcher
    uses synchronisation primitives from <code>nanonext</code>, waiting rather than
    polling for tasks, which is efficient both in terms of consuming no
    resources while waiting, and also being fully synchronised with events
    (having no latency).</p>
<p>By specifying <code>dispatcher = FALSE</code>, daemons connect to the host
    directly rather than through dispatcher. The host sends tasks to
    connected daemons immediately in an evenly-distributed fashion. However,
    optimal scheduling is not guaranteed as the duration of tasks cannot be
    known <em>a priori</em>, such that tasks can be queued at a daemon behind
    a long-running task while other daemons remain idle. Nevertheless, this
    provides a resource-light approach suited to working with similar-length
    tasks, or where concurrent tasks typically do not exceed available daemons.</p>
    </div>
    <div id="local-daemons">
    <h2>Local Daemons</h2>
    


<p>Daemons provide a potentially more efficient solution for asynchronous
    operations as new processes no longer need to be created on an <em>ad
    hoc</em> basis.</p>
<p>Supply the argument 'n' to set the number of daemons. New background
    <code><a href="daemon.html">daemon</a></code> processes are automatically created on the local
    machine connecting back to the host process, either directly or via a
    dispatcher.</p>
    </div>
    <div id="distributed-computing">
    <h2>Distributed Computing</h2>
    


<p>Specifying 'url' allows tasks to be distributed across the network.</p>
<p>The host URL should be a character value such as: 'tcp://192.168.0.2:5555'
    at which daemon processes started using <code><a href="daemon.html">daemon</a></code> should
    connect to. The full shell command to deploy on remote machines may be
    generated by <code><a href="launch_local.html">launch_remote</a></code>.</p>
<p>IPv6 addresses are also supported and must be enclosed in square brackets
    [ ] to avoid confusion with the final colon separating the port. For
    example, port 5555 on the IPv6 loopback address ::1 would be specified
    as 'tcp://[::1]:5555'.</p>
<p>Alternatively, to listen to port 5555 on all interfaces on the local host,
    specify either 'tcp://:5555', 'tcp://*:5555' or 'tcp://0.0.0.0:5555'.</p>
<p>Specifying the wildcard value zero for the port number e.g. 'tcp://:0' or
    'ws://:0' will automatically assign a free ephemeral port. Use
    <code><a href="status.html">status</a></code> to inspect the actual assigned port at any time.</p>
<p><strong>With Dispatcher</strong></p>
<p>When using dispatcher, it is recommended to use a websocket URL rather
    than TCP, as this requires only one port to connect to all daemons: a
    websocket URL supports a path after the port number, which can be made
    unique for each daemon.</p>
<p>Specifying a single host URL such as 'ws://192.168.0.2:5555' with
    <code>n = 6</code> will automatically append a sequence to the path, listening
    to the URLs 'ws://192.168.0.2:5555/1' through 'ws://192.168.0.2:5555/6'.</p>
<p>Alternatively, specify a vector of URLs to listen to arbitrary port
    numbers / paths. In this case it is optional to supply 'n' as this can
    be inferred by the length of vector supplied.</p>
<p>Individual <code><a href="daemon.html">daemon</a></code> instances should then be started on the
    remote resource, which dial in to each of these host URLs. At most one
    daemon should be dialled into each URL at any given time.</p>
<p>Dispatcher automatically adjusts to the number of daemons actually
    connected. Hence it is possible to dynamically scale up or down the
    number of daemons as required, subject to the maximum number initially
    specified.</p>
<p>Alternatively, supplying a single TCP URL will listen at a block of URLs
    with ports starting from the supplied port number and incrementing by one
    for 'n' specified e.g. the host URL 'tcp://192.168.0.2:5555' with
    <code>n = 6</code> listens to the contiguous block of ports 5555 through 5560.</p>
<p><strong>Without Dispatcher</strong></p>
<p>A TCP URL may be used in this case as the host listens at only one
    address, utilising a single port.</p>
<p>The network topology is such that daemons (started with <code><a href="daemon.html">daemon</a></code>)
    or indeed dispatchers (started with <code><a href="dispatcher.html">dispatcher</a></code>) dial into
    the same host URL.</p>
<p>'n' is not required in this case, and disregarded if supplied, as network
    resources may be added or removed at any time. The host automatically
    distributes tasks to all connected daemons and dispatchers.</p>
    </div>
    <div id="compute-profiles">
    <h2>Compute Profiles</h2>
    


<p>By default, the 'default' compute profile is used. Providing a character
    value for '.compute' creates a new compute profile with the name
    specified. Each compute profile retains its own daemons settings, and may
    be operated independently of each other. Some usage examples follow:</p>
<p><strong>local / remote</strong> daemons may be set with a host URL and specifying
    '.compute' as 'remote', which creates a new compute profile. Subsequent
    mirai calls may then be sent for local computation by not specifying its
    '.compute' argument, or for remote computation to connected daemons by
    specifying its '.compute' argument as 'remote'.</p>
<p><strong>cpu / gpu</strong> some tasks may require access to different types of
    daemon, such as those with GPUs. In this case, <code>daemons()</code> may be
    called twice to set up host URLs for CPU-only daemons and for those
    with GPUs, specifying the '.compute' argument as 'cpu' and 'gpu'
    respectively. By supplying the '.compute' argument to subsequent mirai
    calls, tasks may be sent to either 'cpu' or 'gpu' daemons as appropriate.</p>
<p>Note: further actions such as resetting daemons via <code>daemons(0)</code>
    should be carried out with the desired '.compute' argument specified.</p>
    </div>
    <div id="timeouts">
    <h2>Timeouts</h2>
    


<p>Specifying the <code>.timeout</code> argument in <code><a href="mirai.html">mirai</a></code> will ensure
    that the 'mirai' always resolves.</p>
<p>However, the task may not have completed and still be ongoing in the
    daemon process. In such situations, dispatcher ensures that queued tasks
    are not assigned to the busy process, however overall performance may
    still be degraded if they remain in use. If a process hangs and cannot be
    restarted manually, <code><a href="saisei.html">saisei</a></code> specifying <code>force = TRUE</code>
    may be used to cancel the task and regenerate any particular URL for a
    new <code><a href="daemon.html">daemon</a></code> to connect to.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Only run examples in interactive R sessions</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create 2 local daemons (using dispatcher)</span></span></span>
<span class="r-in"><span><span class="fu">daemons</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="status.html">status</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Reset to zero</span></span></span>
<span class="r-in"><span><span class="fu">daemons</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create 2 local daemons (not using dispatcher)</span></span></span>
<span class="r-in"><span><span class="fu">daemons</span><span class="op">(</span><span class="fl">2</span>, dispatcher <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="status.html">status</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Reset to zero</span></span></span>
<span class="r-in"><span><span class="fu">daemons</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2 remote daemons via dispatcher (using zero wildcard)</span></span></span>
<span class="r-in"><span><span class="fu">daemons</span><span class="op">(</span><span class="fl">2</span>, url <span class="op">=</span> <span class="st">"ws://:0"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="status.html">status</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Reset to zero</span></span></span>
<span class="r-in"><span><span class="fu">daemons</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set host URL for remote daemons to dial into (using zero wildcard)</span></span></span>
<span class="r-in"><span><span class="fu">daemons</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"tcp://:0"</span>, dispatcher <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="status.html">status</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Reset to zero</span></span></span>
<span class="r-in"><span><span class="fu">daemons</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Charlie Gao.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

